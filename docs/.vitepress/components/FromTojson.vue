<template>
    <div class="main">
        <el-tabs v-model="activeName" @tab-click="handleClick">
            <el-tab-pane label="WSITEM" name="WSITEM">
                <el-form class="labelbox">
                    <el-form-item class="labeldiv">
                        <el-label for="from">物品ID</el-label>
                        <el-input class="input-1" v-model.number="WSITEM_Parameter.ID"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                            maxlength="10" type="text" show-word-limit />
                    </el-form-item>
                    <el-form-item label="模板物品ID" class="labeldiv workspace">
                        <client-only><el-select v-model="WSITEM_Parameter.GOBJID" clearable placeholder="GOBJID" filterable
                                remote allow-create default-first-option :remote-method="remoteMethod" :loading="loading"
                                @change="generateOutput">
                                <el-option v-for="item in options" :key="item.id"
                                    :label="item.id + (item.name ? ' (' + item.name + ')' : '')" :value="item.id">
                                    <span style="vertical-align: top;">{{ item.name }}</span>
                                    <img :src="item.src" style="width:30px;object-fit: contain;display:inline-block"
                                        v-if="item.src" />
                                    <span style="float:right;color:var(--el-text-color-secondary);font-size: 13px;">{{
                                        item.id }}</span>
                                </el-option>
                            </el-select></client-only>
                    </el-form-item>
                    <el-form-item class="labeldiv"
                        v-for="i in [['物品中文名', 'nameCn'], ['物品英文名', 'nameEn'], ['物品描述', 'description'], ['图片路径', 'iconPath']]">
                        <el-label for="from">{{ i[0] }}</el-label>
                        <el-input class="input-1" v-model="WSITEM_Parameter[i[1]]" :placeholder="i[1]"
                            @input="generateOutput" clearable type="text" />
                    </el-form-item>
                    <el-form-item class="labeldiv"
                        v-for="i in [['攻击力(饱食度)', 'atk'], ['贴图大小', 'Size'], ['武器弹幕贴图位置X', 'FposX'], ['武器弹幕贴图位置Y', 'FposY'], ['最大堆叠数量', 'maxNum'], ['物品价格', 'price'], ['耐久度', 'itemHP']]">
                        <el-label for="from">{{ i[0] }}</el-label>
                        <el-input class="input-1" v-model.number="WSITEM_Parameter[i[1]]" :placeholder="i[1]"
                            @input="generateOutput" clearable type="text"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
                    </el-form-item>
                    <el-form-item label="物品类型" class="labeldiv workspace">
                        <client-only>
                            <el-select v-model="WSITEM_Parameter.itemType" placeholder="itemType" filterable
                                @change="generateOutput">
                                <el-option v-for="i in itemTypeGroup" :key="i.key" :label="`${i.key} (${i.value})`"
                                    :value="i.value"></el-option>
                            </el-select>
                        </client-only>
                    </el-form-item>
                    <el-form-item label="物品品质" class="labeldiv workspace">
                        <client-only>
                            <el-select v-model="WSITEM_Parameter.quality" placeholder="quality" filterable
                                @change="generateOutput">
                                <el-option v-for="i in quality" :key="i.id" :label="`${i.name} (${i.id})`"
                                    :value="i.id"></el-option>
                            </el-select>
                        </client-only>
                    </el-form-item>
                    <el-form-item label="是否可放于副手" class="labeldiv workspace" placeholder="OHand">
                        <el-radio-group v-model="WSITEM_Parameter.OHand" @change="generateOutput">
                            <el-radio-button :label="true">是</el-radio-button>
                            <el-radio-button :label="false">否</el-radio-button>
                        </el-radio-group>
                    </el-form-item>
                </el-form>
                <!--武器-->
                <div style="margin-top: 20px;" v-if="WSITEM_Parameter.itemType == 3 || WSITEM_Parameter.itemType == 58">
                    <el-label style="font-size: 1.3rem;">武器专用参数</el-label>
                    <el-form class="labelbox">
                        <el-form-item label="武器类型" class="labeldiv workspace">
                            <el-select v-model="WSITEM_Parameter.weaponType" clearable placeholder="weaponType" filterable
                                @change="generateOutput">
                                <el-option v-for="i in weaponTypeGroup" :key="i.value" :label="`${i.key} (${i.value})`"
                                    :value="i.value"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="伤害类型" class="labeldiv workspace">
                            <el-select v-model="WSITEM_Parameter.damageType" clearable placeholder="damageType" filterable
                                @change="generateOutput">
                                <el-option v-for="i in damageTypeGroup" :key="i.value" :label="`${i.key} (${i.value})`"
                                    :value="i.value"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item :label="k[0]" class="labeldiv workspace"
                            v-for="k in [['力量补正', 'STRRate'], ['智力补正', 'INTRate'], ['技巧补正', 'TECRate']]">
                            <el-select v-model="WSITEM_Parameter[k[1]]" clearable :placeholder="k[1]" filterable
                                @change="generateOutput">
                                <el-option v-for="i in RateGroup" :key="i.value" :label="`${i.key} (${i.value})`"
                                    :value="i.value"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item class="labeldiv">
                            <el-label for="from">使用弹药类型</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.UseAType" placeholder="UseAType"
                                @input="generateOutput" clearable type="text"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
                        </el-form-item>

                        <el-form-item class="labeldiv">
                            <el-label for="from">弹幕ID</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.AmmoID" placeholder="AmmoID"
                                @input="generateOutput" clearable type="text"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
                        </el-form-item>
                        <el-form-item class="labeldiv">
                            <el-label for="from">攻击角度</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.DAngle" placeholder="DAngle"
                                @input="generateOutput" clearable type="text"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
                        </el-form-item>

                        <div style="width: 100%;"></div>
                        <el-form-item class="labeldiv">
                            <el-label for="from">反作用力</el-label>
                            <el-input-number class="input-1" v-model="WSITEM_Parameter.PPower" placeholder="PPower"
                                @input="generateOutput" clearable :min="0" />
                        </el-form-item>
                        <el-form-item class="labeldiv">
                            <el-label for="from">弹幕数量</el-label>
                            <el-input-number class="input-1" v-model="WSITEM_Parameter.AmmoNum" placeholder="AmmoNum"
                                @input="generateOutput" clearable :min="1" />
                        </el-form-item>
                        <el-form-item class="labeldiv">
                            <el-label for="from">攻击速度</el-label>
                            <el-input-number class="input-1" v-model="WSITEM_Parameter.atkSpeed" placeholder="atkSpeed"
                                @input="generateOutput" clearable :min="0" :max="20" :precision="2" :step="0.01" />
                        </el-form-item>
                        <el-form-item class="labeldiv"
                            v-for="i in [['魔力消耗', 'MPCost'], ['生命消耗', 'HPCost'], ['耐力消耗', 'EPCost'], ['G值消耗', 'GCost'], ['过载消耗', 'OLCost']]">
                            <el-label for="from">{{ i[0] }}</el-label>
                            <el-input-number class="input-1" v-model="WSITEM_Parameter[i[1]]" :placeholder="i[1]"
                                @change="generateOutput" @input="generateOutput" clearable :min="0" :precision="2" :step="0.01" />
                        </el-form-item>
                        <el-form-item class="labeldiv">
                            <el-label for="from">攻击声音路径</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.ATKAudio" placeholder="ATKAudio"
                                @input="generateOutput" clearable type="text"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
                        </el-form-item>
                        <client-only>
                            <el-form-item label="攻击声音大小" class="labeldiv workspace">
                                <el-slider v-model="WSITEM_Parameter.ATKAudioVolume" :min="0" :max="100"
                                    @input="generateOutput" style="width:100%" />
                            </el-form-item>
                        </client-only>

                        <el-form-item label="是否近战攻击" class="labeldiv workspace">
                            <el-radio-group v-model="WSITEM_Parameter.CloseATK" @change="generateOutput">
                                <el-radio-button :label="true">是</el-radio-button>
                                <el-radio-button :label="false">否</el-radio-button>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="是否随机攻击角度" class="labeldiv workspace">
                            <el-radio-group v-model="WSITEM_Parameter.RDAngle" @change="generateOutput">
                                <el-radio-button :label="true">是</el-radio-button>
                                <el-radio-button :label="false">否</el-radio-button>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="是否为蓄力武器" class="labeldiv workspace">
                            <el-radio-group v-model="WSITEM_Parameter.SPATK" @change="generateOutput">
                                <el-radio-button :label="true">是</el-radio-button>
                                <el-radio-button :label="false">否</el-radio-button>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item class="labeldiv" v-if="WSITEM_Parameter.SPATK === true">
                            <el-label for="from">蓄力攻击声音路径</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.SPATKAudio" placeholder="SPATKAudio"
                                @input="generateOutput" clearable type="text"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
                        </el-form-item>
                    </el-form>
                </div>
                <!--建筑-->
                <div style="margin-top: 20px;" v-if="WSITEM_Parameter.itemType == 7">
                    <el-label style="font-size: 1.3rem;">建筑专用参数</el-label>
                    <el-form class="labelbox">
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">大建筑类型</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.BDType" placeholder="BDType"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                                maxlength="10" type="text" show-word-limit />
                        </el-form-item>
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">建筑类型</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.BuildingType"
                                placeholder="BuildingType" oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                                @input="generateOutput" clearable maxlength="10" type="text" show-word-limit />
                        </el-form-item>
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">光照颜色</el-label>
                            <el-input class="input-1" v-model="WSITEM_Parameter.LightColor" placeholder="LightColor"
                                @input="generateOutput" clearable maxlength="9" type="text" show-word-limit />
                            <client-only><el-color-picker v-model="WSITEM_Parameter.LightColor" show-alpha
                                    color-format="hex"
                                    :predefine="['#ff4b4b', '#55f5ff', '#ffff00', '#ff7c81', '#fb6e92', '#7c9eff', '#81fe7c', '#ffaa4b', '#008000', '#006da0', '#7b92ff', '#eda4ff', '#fea500', '#ff7061', '#fffe84', '#916df6', '#93c0ff', '#93fdff', '#93ffc3', '#c3c3c3', '#FFFAFA']"
                                    @change="generateOutput" /></client-only>
                        </el-form-item>
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">光照范围</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.LightRange" placeholder="LightRange"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                                maxlength="10" type="text" show-word-limit />
                        </el-form-item>
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">光照强度</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.LightIntensity"
                                placeholder="LightIntensity" oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                                @input="generateOutput" clearable maxlength="10" type="text" show-word-limit />
                        </el-form-item>
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">挖掘所需工具力</el-label>
                            <el-input class="input-1" v-model.number="WSITEM_Parameter.miniATK" placeholder="miniATK"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                                maxlength="2" type="text" show-word-limit />
                        </el-form-item>

                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">建筑生命值</el-label>
                            <el-input-number class="input-1" v-model.number="WSITEM_Parameter.BuildHP" placeholder="BuildHP"
                                :min="0" oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput"
                                clearable maxlength="10" type="text" show-word-limit />
                        </el-form-item>

                        <div style="width:100%"></div>
                        <el-form-item :label="i[1]" class="labeldiv workspace" v-for="i in [
                            ['collider', '是否有碰撞器'],
                            ['surface', '是否显示于最底层'],
                            ['BdInSea', '是否只能放在液体中'],
                            ['fallDSelf', '是否掉落自身'],
                        ]">
                            <el-radio-group v-model="WSITEM_Parameter[i[0]]" @change="generateOutput">
                                <el-radio-button :label="true">是</el-radio-button>
                                <el-radio-button :label="false">否</el-radio-button>
                            </el-radio-group>
                        </el-form-item>

                        <client-only>
                            <div style="width:100%;overflow-x:auto;">
                                <table class="table" style="width:100%">
                                    <tr>
                                        <th width="200">掉落物</th>
                                        <th width="200">数量</th>
                                        <th width="200">概率</th>
                                        <th width="50"></th>
                                    </tr>
                                    <tr v-for="(item, index) in WSITEM_Parameter.fallDItems" :key="index">
                                        <td>
                                            <client-only><el-select v-model.number="WSITEM_Parameter.fallDItems[index]"
                                                    clearable :placeholder="'fallDItem' + (index + 1)" filterable remote
                                                    allow-create default-first-option :remote-method="remoteMethod"
                                                    :loading="loading" @change="generateOutput">
                                                    <el-option v-for="item in options" :key="item.id"
                                                        :label="item.id + (item.name ? ' (' + item.name + ')' : '')"
                                                        :value="item.id">
                                                        <span style="vertical-align: top;">{{ item.name }}</span>
                                                        <img :src="item.src"
                                                            style="width:30px;object-fit: contain;display:inline-block"
                                                            v-if="item.src" />
                                                        <span
                                                            style="float:right;color:var(--el-text-color-secondary);font-size: 13px;">{{
                                                                item.id }}</span>
                                                    </el-option>
                                                </el-select></client-only>
                                        </td>
                                        <td>
                                            <el-input-number v-model="WSITEM_Parameter.fallDItemsNum[index]" :min="1"
                                                @input="generateOutput" clearable maxlength="10" />
                                        </td>
                                        <td>
                                            <el-slider v-model="WSITEM_Parameter.fallDItemsRate[index]" :min="0" :max="100"
                                                @input="generateOutput" />
                                        </td>
                                        <td>
                                            <el-button type="danger" :icon="Delete" @click="delFallDItems(index)" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </client-only>
                        <div><el-button type="primary" :icon="Plus" @click="addFallDItems">添加掉落物</el-button></div>

                    </el-form>
                </div>
                <!--装备/食物-->
                <div style="margin-top: 20px;"
                    v-if="[12, 17, 18, 19, 20, 22, 31, 32].indexOf(WSITEM_Parameter.itemType) !== -1">
                    <el-label style="font-size: 1.3rem;">装备/食物专用参数</el-label>
                    <el-form class="labelbox">
                        <client-only>
                            <div style="width:100%;overflow-x:auto;">
                                <table class="table" style="width:100%">
                                    <tr>
                                        <th width="200">Buff ID</th>
                                        <th width="150">Buff等级</th>
                                        <th width="50"></th>
                                    </tr>
                                    <tr v-for="(item, index) in WSITEM_Parameter.buffs" :key="index">
                                        <td>
                                            <el-input v-model.number="WSITEM_Parameter.buffs[index]"
                                                :placeholder="'buff' + (index + 1)"
                                                oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                                                @input="generateOutput" clearable maxlength="10" type="text"
                                                show-word-limit />
                                        </td>
                                        <td>
                                            <el-input-number v-model="WSITEM_Parameter.buffsLV[index]" :min="1"
                                                @input="generateOutput" clearable maxlength="10" />
                                        </td>
                                        <td>
                                            <el-button type="danger" :icon="Delete" @click="delBuff(index)" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </client-only>
                        <div><el-button type="primary" :icon="Plus" @click="addBuff">添加Buff</el-button></div>

                    </el-form>
                </div>
                <!--帽子/衣服-->
                <div style="margin-top: 20px;" v-if="[17, 18, 22, 31].indexOf(WSITEM_Parameter.itemType) !== -1">
                    <el-label style="font-size: 1.3rem;">帽子/衣服专用参数</el-label>
                    <el-form class="labelbox">
                        <client-only>
                            <div style="width:100%;overflow-x:auto;">
                                <table class="table" style="width:100%">
                                    <tr>
                                        <th width="400">动画帧图片文件名</th>
                                        <th width="50"></th>
                                    </tr>
                                    <tr v-for="(item, index) in WSITEM_Parameter.anime" :key="index">
                                        <td>
                                            <el-input v-model="WSITEM_Parameter.anime[index]" placeholder="anime/x1.png"
                                                @input="generateOutput" clearable type="text" />
                                        </td>
                                        <td>
                                            <el-button type="danger" :icon="Delete" @click="delAnime(index)" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </client-only>
                        <div><el-button type="primary" :icon="Plus" @click="addAnime">添加动画帧</el-button></div>

                    </el-form>
                </div>

                <div style="margin-top: 20px;">
                    <!--<el-button type="primary" @click="generateOutput" :icon="Plus">生成JSON</el-button>-->
                    <el-button type="primary" @click="copyToClipboard" :icon="DocumentCopy">复制到剪切板</el-button>
                    <el-button type="warning" @click="download" :icon="Download">下载json文件</el-button>
                    <el-input type="textarea" :rows="30" v-model="WSITEM_Output" style="margin-top: 20px;"
                        class="el-place" />
                </div>
            </el-tab-pane>


            <el-tab-pane label="CM" name="CM">
                <el-form class="labelbox">
                    <el-form-item class="labeldiv">
                        <el-label for="from">配方ID</el-label>
                        <el-input class="input-1" v-model.number="CM_Parameter.ID"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                            maxlength="10" type="text" show-word-limit />
                    </el-form-item>
                    <div style="width: 100%; "></div>
                    <template v-for="(ai, i) in [1, 0, 0, 0]">
                        <el-form-item :label="'材料' + (i + 1)" class="labeldiv workspace">
                            <client-only>
                                <el-select v-model="CM_Parameter['mat' + (i + 1)]" clearable :placeholder="'mat' + (i + 1)"
                                    filterable remote allow-create default-first-option :remote-method="remoteMethod"
                                    :loading="loading" @change="generateOutput">
                                    <el-option v-for="item in options" :key="item.id"
                                        :label="item.id + (item.name ? ' (' + item.name + ')' : '')" :value="item.id">
                                        <span style="vertical-align: top;">{{ item.name }}</span>
                                        <img :src="item.src" style="width:30px;object-fit: contain;display:inline-block"
                                            v-if="item.src" />
                                        <span style="float:right;color:var(--el-text-color-secondary);font-size: 13px;">{{
                                            item.id }}</span>
                                    </el-option>
                                </el-select>
                            </client-only>
                        </el-form-item>
                        <el-form-item class="labeldiv el-from-item">
                            <el-label for="from">材料{{ i + 1 }}数量</el-label>
                            <el-input-number class="input-1" v-model.number="CM_Parameter['mat' + (i + 1) + 'Num']"
                                :placeholder="'mat' + (i + 1) + 'num'" :min="ai"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                                maxlength="10" type="text" show-word-limit />
                        </el-form-item>
                    </template>

                    <el-form-item label="输出物品" class="labeldiv workspace">
                        <client-only><el-select v-model="CM_Parameter.result" clearable placeholder="result" filterable
                                remote allow-create default-first-option :remote-method="remoteMethod" :loading="loading"
                                @change="generateOutput">
                                <el-option v-for="item in options" :key="item.id"
                                    :label="item.id + (item.name ? ' (' + item.name + ')' : '')" :value="item.id">
                                    <span style="vertical-align: top;">{{ item.name }}</span>
                                    <img :src="item.src" style="width:30px;object-fit: contain;display:inline-block"
                                        v-if="item.src" />
                                    <span style="float:right;color:var(--el-text-color-secondary);font-size: 13px;">{{
                                        item.id }}</span>
                                </el-option>
                            </el-select></client-only>
                    </el-form-item>
                    <el-form-item class="labeldiv">
                        <el-label for="from">输出物品数量</el-label>
                        <el-input-number class="input-1" v-model.number="CM_Parameter.resultNum" placeholder="resultnum"
                            :min="1" oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput"
                            clearable maxlength="10" type="text" show-word-limit />
                    </el-form-item>

                    <el-form-item label="工作站" class="labeldiv workspace">
                        <client-only><el-select v-model="CM_Parameter.place" filterable placeholder="请选择工作站"
                                @change="generateOutput" style="width: 100%">
                                <el-option v-for="item in places" :key="item.id" :label="`${item.id} (${item.name})`"
                                    :value="item.id">
                                </el-option>
                            </el-select></client-only>
                    </el-form-item>
                </el-form>
                <div style="margin-top: 20px;">
                    <!--<el-button type="primary" @click="generateOutput" :icon="Plus">生成JSON</el-button>-->
                    <el-button type="primary" @click="copyToClipboard" :icon="DocumentCopy">复制到剪切板</el-button>
                    <el-button type="warning" @click="download" :icon="Download">下载json文件</el-button>
                    <el-input type="textarea" :rows="12" v-model="CM_Output" style="margin-top: 20px;" class="el-place" />
                </div>
            </el-tab-pane>


            <el-tab-pane label="WSAMMO" name="WSAMMO">
                <el-form class="labelbox">
                    <el-form-item class="labeldiv">
                        <el-label for="from">弹幕ID</el-label>
                        <el-input class="input-1" v-model.number="WSAMMO_Parameter.AID"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                            maxlength="10" type="text" show-word-limit />
                    </el-form-item>

                    <el-form-item :label="i[1]" class="labeldiv workspace" v-for="i in [
                        ['wakeType', '拖尾类型', [[0, '']]],
                        ['MPType', '运动类型', [[0, '']]],
                    ]">
                        <client-only>
                            <el-select v-model="WSAMMO_Parameter[i[0]]" :placeholder="i[0]" filterable allow-create
                                @change="generateOutput">
                                <el-option v-for="j in i[2]" :key="j[0]" :label="`${j[1]} (${j[0]})`"
                                    :value="j[0]"></el-option>
                            </el-select>
                        </client-only>
                    </el-form-item>

                    <el-form-item :label="i[1]" class="labeldiv workspace" v-for="i in [
                        ['AHP', '弹幕生命值'],
                        ['Speed', '飞行速度'],
                        ['SFloating', '速度浮动'],
                        ['PassCount', '通过计数'],
                        ['rotateSpeed', '旋转速度'],
                        ['DTime', '持续时间'],
                        ['ATKSpeed', '攻击速度'],
                        ['sortLayer', '排序层级'],
                        ['SpeedSlowDown', '速度减缓'],
                        ['SpeedSlowDelay', '速度减缓延迟'],
                        ['TipsAID', '初始化弹幕ID'],
                        ['HitAudio', '命中声音文件路径'],
                        ['InitAudio', '初始化声音文件路径'],
                        ['TimeAudio', '持续声音文件路径'],
                        ['HitAID', '命中释放弹幕ID'],
                    ]">
                        <el-input class="input-1" v-model.number="WSAMMO_Parameter[i[0]]" :placeholder="i[0]"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                            maxlength="10" type="text" show-word-limit />
                    </el-form-item>

                    <el-form-item :label="i[1]" class="labeldiv workspace" v-for="i in [
                        ['HitANum', '命中释放弹幕数量'],
                        ['FollowLV', '追踪等级'],
                        ['FollowInterval', '追踪间隔'],
                    ]">
                        <el-input-number class="input-1" v-model.number="WSAMMO_Parameter[i[0]]"
                          @input="generateOutput" />
                    </el-form-item>
                    
                    <client-only>
                      <el-form-item :label="i[1]" class="labeldiv workspace" v-for="i in [
                        ['HitAV', '命中声音大小'],
                        ['TimeAV', '持续声音大小'],
                      ]">
                        <el-slider v-model="WSITEM_Parameter[i[0]]" :min="0" :max="100"
                            @input="generateOutput" style="width:100%" />
                      </el-form-item>
                    </client-only>

                    <el-form-item class="labeldiv el-from-item">
                        <el-label for="from">光照颜色</el-label>
                        <el-input class="input-1" v-model="WSAMMO_Parameter.LightColor" placeholder="LightColor"
                            @input="generateOutput" clearable maxlength="9" type="text" show-word-limit />
                        <client-only><el-color-picker v-model="WSAMMO_Parameter.LightColor" show-alpha color-format="hex"
                                :predefine="['#ff4b4b', '#55f5ff', '#ffff00', '#ff7c81', '#fb6e92', '#7c9eff', '#81fe7c', '#ffaa4b', '#008000', '#006da0', '#7b92ff', '#eda4ff', '#fea500', '#ff7061', '#fffe84', '#916df6', '#93c0ff', '#93fdff', '#93ffc3', '#c3c3c3', '#FFFAFA']"
                                @change="generateOutput" /></client-only>
                    </el-form-item>
                    <el-form-item class="labeldiv el-from-item">
                        <el-label for="from">光照范围</el-label>
                        <el-input class="input-1" v-model.number="WSAMMO_Parameter.LightRange" placeholder="LightRange"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" @input="generateOutput" clearable
                            maxlength="10" type="text" show-word-limit />
                    </el-form-item>
                    <el-form-item class="labeldiv el-from-item">
                        <el-label for="from">光照强度</el-label>
                        <el-input class="input-1" v-model.number="WSAMMO_Parameter.LightIntensity"
                            placeholder="LightIntensity" oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                            @input="generateOutput" clearable maxlength="10" type="text" show-word-limit />
                    </el-form-item>
                    
                    <el-form-item :label="i[1]" class="labeldiv workspace" v-for="i in [
                        ['HitTrigger', '命中触发'],
                        ['BreakTrigger', '销毁触发'],
                        ['TimeOutTrigger', '超时触发'],
                        ['haveAnime', '是否有动画'],
                    ]">
                        <el-radio-group v-model="WSAMMO_Parameter[i[0]]" @change="generateOutput">
                            <el-radio-button :label="true">是</el-radio-button>
                            <el-radio-button :label="false">否</el-radio-button>
                        </el-radio-group>
                    </el-form-item>
                    <template v-if="WSAMMO_Parameter.haveAnime">
                        <el-form-item label="动画速度" class="labeldiv">
                            <el-input-number class="input-1" v-model.number="WSAMMO_Parameter.AnimeSpeed" :min="0"
                                @input="generateOutput" />
                        </el-form-item>
                        <client-only>
                            <div style="width:100%;overflow-x:auto;">
                                <table class="table" style="width:100%">
                                    <tr>
                                        <th width="400">动画帧图片文件名</th>
                                        <th width="50"></th>
                                    </tr>
                                    <tr v-for="(item, index) in WSAMMO_Parameter.anime" :key="index">
                                        <td>
                                            <el-input v-model="WSAMMO_Parameter.anime[index]" placeholder="anime/x1.png"
                                                @input="generateOutput" clearable type="text" />
                                        </td>
                                        <td>
                                            <el-button type="danger" :icon="Delete" @click="delAnime_AMMO(index)" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </client-only>
                        <div><el-button type="primary" :icon="Plus" @click="addAnime_AMMO">添加动画帧</el-button></div>
                    </template>
                </el-form>
                <div style="margin-top: 20px;">
                    <!--<el-button type="primary" @click="generateOutput" :icon="Plus">生成JSON</el-button>-->
                    <el-button type="primary" @click="copyToClipboard" :icon="DocumentCopy">复制到剪切板</el-button>
                    <el-button type="warning" @click="download" :icon="Download">下载json文件</el-button>
                    <el-input type="textarea" :rows="20" v-model="WSAMMO_Output" style="margin-top: 20px;"
                        class="el-place" />
                </div>
            </el-tab-pane>
        </el-tabs>

    </div>
</template>

<script setup>
import { onMounted, ref, reactive } from 'vue'
import { ElMessage } from 'element-plus'
import { DocumentCopy, Plus, Delete, Download } from '@element-plus/icons-vue'
import requests from './requests';
import FileSaver from 'file-saver';

const loading = ref(false) 
const options = ref([])

function similar(s, t, f = 3) {
    if (!s || !t) {
        return 0
    }
    var l = s.length > t.length ? s.length : t.length
    var n = s.length
    var m = t.length
    var d = []
    var min = function (a, b, c) {
        return a < b ? (a < c ? a : c) : (b < c ? b : c)
    }
    var i, j, si, tj, cost
    if (n === 0) return m
    if (m === 0) return n
    for (i = 0; i <= n; i++) {
        d[i] = []
        d[i][0] = i
    }
    for (j = 0; j <= m; j++) {
        d[0][j] = j
    }
    for (i = 1; i <= n; i++) {
        si = s.charAt(i - 1)
        for (j = 1; j <= m; j++) {
            tj = t.charAt(j - 1)
            if (si === tj) {
                cost = 0
            } else {
                cost = 1
            }
            d[i][j] = min(d[i - 1][j] + 1, d[i][j - 1] + 1, d[i - 1][j - 1] + cost)
        }
    }
    let res = (1 - d[n][m] / l)
    return res.toFixed(f)
}

const remoteMethod = async (query) => {
    //console.log(query)
    if (query) {
        loading.value = true
        let url = 'https://hgadventure.huijiwiki.com/w/api.php'

        await requests.request({
            url: url,
            method: 'GET',
            params: {
                action: 'ask',
                query: `[[type::物品]] [[${/^\d+$/.test(query) ? 'Id' : '名称'}::~${query}]]|?Id|?名称|?图片`,
                format: 'json'
            }
        }).then((r) => {
            //console.log(r.data)
            loading.value = false
            options.value = []
            if (!r.data || !r.data.query.results) return;
            r = r.data.query.results
            let res = []
            if (WSITEM_Parameter.ID) res.push({ id: WSITEM_Parameter.ID, name: WSITEM_Parameter.nameCn });
            //console.log(Object.values(r))
            r = Object.values(r)
            r.sort((a, b) => { return similar(b.printouts['名称'][0], query) - similar(a.printouts['名称'][0], query) })
            r.forEach(i => {
                let v = i.printouts
                let src = v['图片'][0]
                if (src.indexOf('.') === -1) src = src + '.png';
                src = 'https://hgadventure.huijiwiki.com/wiki/Special:FilePath/' + src;
                res.push({ id: v.Id[0], name: v['名称'][0], src: src });
            })
            options.value = res
        })
    } else {
        options.value = []
    }
}

const activeName = ref('WSITEM')
//工作站选择
const places = [
    { id: 0, name: '工作台' },
    { id: 1, name: '熔炉' },
    { id: 2, name: '随手制造' },
    { id: 3, name: '超大锅' },
    { id: 4, name: '铁砧' },
    { id: 5, name: '鸟鸟商店' },
    { id: 6, name: '切割机' },
    { id: 7, name: '炼金台' },
    { id: 8, name: '种子转换机' },
    { id: 9, name: '小际姬4407商店' },
    { id: 10, name: '阿米商店' },
    { id: 11, name: '星神商店' },
    { id: 12, name: 'genso商店' },
    { id: 13, name: '明石商店' },
    { id: 14, name: '？？？器械' },
    { id: 15, name: '饰品台' },
    { id: 16, name: '火龙果商店' },
    { id: 17, name: '萤萤商店' },
    { id: 18, name: '星雪商店' },
    { id: 19, name: '？？？器械' },
    { id: 20, name: '电工台' },
    { id: 21, name: '压碳机' },
    { id: 22, name: '亚物质分子转换机' },
    { id: 23, name: '芒芒商店' },
    { id: 24, name: 'leko商店' },
    { id: 25, name: '酿造桶' },
    { id: 26, name: '反物质熔炉' },
    { id: 27, name: '亚原子复制机' },
    { id: 28, name: '百科全书' },
    { id: 29, name: '炼金解析机' },
    { id: 30, name: '中中商店' },
    { id: 31, name: '小际姬1349商店' },
    { id: 32, name: '小库商店' },
    { id: 33, name: '皓际商店' },
    { id: 34, name: 'VV商店' },
    { id: 35, name: '月商店' },
    { id: 36, name: '柠宁商店' },
    { id: 37, name: '沧曙商店' },
    { id: 38, name: '斩斩商店' },
    { id: 39, name: '笔笔商店' },
    { id: 40, name: '材料解析' },
    { id: 41, name: '？？？器械' },
    { id: 42, name: '帕瓦商店' },
    { id: 43, name: '鬼鬼商店' },
    { id: 44, name: '高温熔炉' },
    { id: 45, name: 'cc商店' },
    { id: 46, name: '小际姬424商店' },
    { id: 47, name: '法法商店' },
    { id: 48, name: '魔石熔炉' },
    { id: 49, name: '核子熔炉' },
]

const WSITEM_Parameter = reactive({
    ID: 10001,
    GOBJID: '',
    nameCn: '',
    nameEn: '',
    description: '',
    iconPath: '',
    atk: '',
    quality: 0,
    maxNum: 1,
    price: '',
    Size: '',
    FposX: '',
    FposY: '',
    itemType: '',
    OHand: false,
    weaponType: '',
    damageType: '',
    STRRate: '',
    INTRate: '',
    TECRate: '',
    CloseATK: false,
    RDAngle: false,
    miniATK: '',
    AmmoID: '',
    AmmoNum: '',
    atkSpeed: '',
    MPCost: '',
    HPCost: '',
    EPCost: '',
    GCost: '',
    OLCost: '',
    DAngle: '',
    PPower: '',
    UseAType: '',
    BDType: '',
    BuildingType: '',
    LightColor: '',
    LightRange: '',
    LightIntensity: '',
    BuildHP: '',
    collider: false,
    surface: false,
    BdInSea: false,
    fallDSelf: false,
    fallDItems: [],
    fallDItemsNum: [],
    fallDItemsRate: [],
    buffs: [],
    buffsLV: [],
    anime: [],
    SPATK: false,
    ATKAudio: '',
    SPATKAudio: '',
    ATKAudioVolume: ''
})

//物品分类
const itemTypeGroup = [
    { 'key': '未知(礼物)', 'value': 1 },
    { 'key': '工具', 'value': 2 },
    { 'key': '武器', 'value': 3 },
    { 'key': '锄头', 'value': 4 },
    { 'key': '种子', 'value': 5 },
    { 'key': '植物', 'value': 6 },
    { 'key': '建筑', 'value': 7 },
    { 'key': '次元钱包', 'value': 8 },
    { 'key': '镐', 'value': 9 },
    { 'key': '箭', 'value': 10 },
    { 'key': '布料', 'value': 11 },
    { 'key': '食物', 'value': 12 },
    { 'key': '铲子', 'value': 13 },
    { 'key': '钓鱼杆', 'value': 14 },
    { 'key': '斧头', 'value': 15 },
    { 'key': '信息', 'value': 16 },
    { 'key': '头盔', 'value': 17 },
    { 'key': '衣服', 'value': 18 },
    { 'key': '鞋子', 'value': 19 },
    { 'key': '饰品', 'value': 20 },
    { 'key': '弹药', 'value': 21 },
    { 'key': '魔甲', 'value': 22 },
    { 'key': '全能开采工具', 'value': 23 },
    { 'key': '未知', 'value': 24 },
    { 'key': '容器', 'value': 25 },
    { 'key': '水壶', 'value': 26 },
    { 'key': '矿石', 'value': 27 },
    { 'key': '木材', 'value': 28 },
    { 'key': '召唤物', 'value': 29 },
    { 'key': '未知(效果)', 'value': 30 },
    { 'key': '魔冠', 'value': 31 },
    { 'key': '魔鞋', 'value': 32 },
    { 'key': '飞弹', 'value': 33 },
    { 'key': '轨道车', 'value': 34 },
    { 'key': '宠物', 'value': 35 },
    { 'key': '事件召唤物', 'value': 36 },
    { 'key': '投掷物', 'value': 37 },
    { 'key': '盲盒', 'value': 38 },
    { 'key': '鱼饵', 'value': 39 },
    { 'key': '肥料', 'value': 40 },
    { 'key': '未知(导线)', 'value': 41 },
    { 'key': '未知(剪线器)', 'value': 42 },
    { 'key': '陨石', 'value': 43 },
    { 'key': '未知(藏宝图)', 'value': 44 },
    { 'key': '土壤肥料', 'value': 45 },
    { 'key': '地板', 'value': 46 },
    { 'key': '技能书', 'value': 47 },
    { 'key': '时钟', 'value': 48 },
    { 'key': '特殊装备', 'value': 49 },
    { 'key': '炼金笔记', 'value': 50 },
    { 'key': '炼金物质', 'value': 51 },
    { 'key': '技能指南', 'value': 52 },
    { 'key': '伙伴', 'value': 53 },
    { 'key': '未知(帮助)', 'value': 54 },
    { 'key': '魔法', 'value': 55 },
    { 'key': '信号弹', 'value': 56 },
    { 'key': '魔导杖', 'value': 57 },
    { 'key': '魔剑', 'value': 58 },
    { 'key': '锭', 'value': 59 },
    { 'key': '护身符', 'value': 60 },
    { 'key': '附魔石', 'value': 61 },
    { 'key': '转生信物', 'value': 62 },
    { 'key': '魔饰', 'value': 63 },
    { 'key': '魔药', 'value': 64 },
    { 'key': '动物', 'value': 65 },
    { 'key': '辅助机', 'value': 66 },
    { 'key': '物质线', 'value': 67 }
]

//物品品质
const quality = [
    { id: -1, name: '垃圾' },
    { id: 0, name: '常见' },
    { id: 1, name: '普通' },
    { id: 2, name: '不寻常' },
    { id: 3, name: '稀有' },
    { id: 4, name: '非常稀有' },
    { id: 5, name: '超绝稀有' },
    { id: 6, name: '传说' },
    { id: 7, name: '神级' },
]

//武器小分类
const weaponTypeGroup = [
    { 'key': '枪', 'value': 0 },
    { 'key': '特殊', 'value': 1 },
    { 'key': '剑', 'value': 2 },
    { 'key': '短剑', 'value': 3 },
    { 'key': '赋予', 'value': 4 },
    { 'key': '照明', 'value': 5 },
    { 'key': '投掷', 'value': 6 },
    { 'key': '长枪', 'value': 7 },
    { 'key': '弓', 'value': 8 },
    { 'key': '手持盾', 'value': 9 },
    { 'key': '特殊', 'value': 10 },
    { 'key': '特殊', 'value': 11 },
    { 'key': '特殊', 'value': 12 },
    { 'key': '战斧', 'value': 13 },
    { 'key': '机关', 'value': 14 },
    { 'key': '伙伴', 'value': 15 },
    { 'key': '特殊', 'value': 16 },
    { 'key': '剑', 'value': 17 },
    { 'key': '特殊', 'value': 18 },
    { 'key': '特殊', 'value': 19 },
    { 'key': '特殊', 'value': 20 },
    { 'key': '鞭', 'value': 21 },
    { 'key': '霰弹枪', 'value': 22 },
    { 'key': '电锯', 'value': 23 },
    { 'key': '回旋镖', 'value': 24 },
    { 'key': '元素爆破', 'value': 25 },
    { 'key': '枪剑', 'value': 26 }
]
//伤害类型
const damageTypeGroup = [
    { 'key': '未知', 'value': -1 },
    { 'key': '物理', 'value': 0 },
    { 'key': '魔法', 'value': 1 },
    { 'key': '魔物', 'value': 2 },
    { 'key': '射手', 'value': 3 },
    { 'key': '未知', 'value': 4 },
    { 'key': '恢复', 'value': 5 },
    { 'key': '元素', 'value': 6 },
    { 'key': '机械', 'value': 7 },
    { 'key': '暗伤害', 'value': 8 },
    { 'key': '元素', 'value': 9 },
    { 'key': '未知', 'value': 10 }
]

//补正
const RateGroup = [
    { 'key': '无', 'value': 0 },
    { 'key': 'E', 'value': 1 },
    { 'key': 'D', 'value': 2 },
    { 'key': 'C', 'value': 3 },
    { 'key': 'B', 'value': 4 },
    { 'key': 'A', 'value': 5 },
    { 'key': 'S', 'value': 6 },
    { 'key': 'SS', 'value': 7 },
    { 'key': 'SSS', 'value': 8 },
    { 'key': 'MX', 'value': 9 },
    { 'key': 'EX', 'value': 10 },
    { 'key': 'GX', 'value': 11 }
]

const CM_Parameter = reactive({
    ID: 10001,
    mat1: '',
    mat1Num: 1,
    mat2: '',
    mat2Num: '',
    mat3: '',
    mat3Num: '',
    mat4: '',
    mat4Num: '',
    result: '',
    resultNum: 1,
    place: 0
})

const WSAMMO_Parameter = reactive({
    AID: 10001,
    wakeType: 0,
    MPType: 0,
    AHP: '',
    Speed: '',
    SFloating: '',
    PassCount: '',
    rotateSpeed: '',
    DTime: '',
    ATKSpeed: '',
    sortLayer: '',
    SpeedSlowDown: '',
    SpeedSlowDelay: '',
    BreakTrigger: false,
    HitTrigger: false,
    TimeOutTrigger: false,
    HitAID: '',
    HitANum: '',
    TipsAID: '',
    FollowLV: 0,
    FollowInterval: 0,
    LightRange: 0,
    LightIntensity: 0,
    LightColor: '',
    haveAnime: false,
    anime: [],
    AnimeSpeed: '',
})

const WSITEM_Output = ref('')
const CM_Output = ref('')
const WSAMMO_Output = ref('')

const handleClick = function (tab, e) {
    //console.log(tab, e);
    setTimeout(generateOutput, 10);
}

const addBuff = () => {
    WSITEM_Parameter.buffs.push('');
    WSITEM_Parameter.buffsLV.push(1);
    generateOutput();
}

const delBuff = (index) => {
    WSITEM_Parameter.buffs.splice(index, 1);
    WSITEM_Parameter.buffsLV.splice(index, 1);
    generateOutput();
}

const addFallDItems = () => {
    WSITEM_Parameter.fallDItems.push(0);
    WSITEM_Parameter.fallDItemsNum.push(1);
    WSITEM_Parameter.fallDItemsRate.push(0);
    generateOutput();
}

const delFallDItems = (index) => {
    WSITEM_Parameter.fallDItems.splice(index, 1);
    WSITEM_Parameter.fallDItemsNum.splice(index, 1);
    WSITEM_Parameter.fallDItemsRate.splice(index, 1);
    generateOutput();
}

const addAnime = () => {
    WSITEM_Parameter.anime.push('');
    generateOutput();
}

const delAnime = (index) => {
    WSITEM_Parameter.anime.splice(index, 1);
    generateOutput();
}

const addAnime_AMMO = () => {
    WSAMMO_Parameter.anime.push('');
    generateOutput();
}

const delAnime_AMMO = (index) => {
    WSAMMO_Parameter.anime.splice(index, 1);
    generateOutput();
}

const toUnicode = function (s) {
    return s.replace(/[^\x00-\x7F]/g, x => "\\u" + ("000" + x.codePointAt(0).toString(16)).slice(-4));
}

//生成json
const generateOutput = () => {
    // console.log(CM_Parameter)  
    switch (activeName.value) {
        case 'WSITEM':
            WSITEM_Output.value = JSON.stringify(WSITEM_Parameter, (k, v) => {
                if (v === "") {
                    if (k === 'nameCn') return '必填';
                    return;
                }
                // 武器，魔剑专属参数
                if ([3, 58].indexOf(WSITEM_Parameter.itemType) === -1 && 
                    ['weaponType', 'demageType', 'STRRate', 'INTRate', 
                     'TECRate', 'CloseATK', 'RDAngle', 'AmmoID', 'AmmoNum', 
                     'atkSpeed', 'MPCost', 'HPCost', 'EPCost', 'GCost', 
                     'OLCost', 'DAngle', 'PPower', 'UseAType', 
                     'SPATK', 'ATKAudio', 'SPATKAudio', 'ATKAudioVolume'].indexOf(k) !== -1)
                    return;
                // 建筑专属参数
                if (WSITEM_Parameter.itemType != 7 && 
                    ['BDType', 'BuildingType', 'LightColor', 'LightRange',
                     'LightIntensity', 'miniATK', 'fallDSelf', 'fallDItems', 
                     'fallDItemsNum', 'fallDItemsRate', 'BuildHP', 'collider',
                     'surface', 'BdInSea'].indexOf(k) !== -1) 
                    return;
                // 食物，帽子，衣服，鞋子，饰品，魔衣，魔冠，魔鞋专属参数
                if (([12, 17, 18, 19, 20, 22, 31, 32].indexOf(WSITEM_Parameter.itemType) === -1) &&
                     (k === 'buffs' || k === 'buffsLV')) 
                    return;
                // 帽子，衣服，魔冠，魔鞋专属参数
                if (([17, 18, 22, 31].indexOf(WSITEM_Parameter.itemType) === -1) &&
                     (k === 'anime')) 
                    return;

                if (typeof v === 'string') {
                    if (k === 'GOBJID') {
                        if (/^\d+$/.test(v)) {
                            return parseInt(v);
                        } else {
                            return '只能是正整数';
                        }
                    }
                    return toUnicode(v);
                }
                if (k === 'buffs' || k === 'buffsLV' || k === 'fallDItems' || k === 'anime') {
                    return v.filter((x) => { return x !== '' && x !== null });
                }
                if (k === 'atkSpeed' || k === 'MPCost' || k === 'HPCost' || k === 'EPCost' || k === 'GCost' || k === 'OLCost') {
                    return parseInt(v * 100);
                }
                return v;
            }, 4).replaceAll('\\\\u', '\\u').replaceAll(/(?<="(fallDItems|fallDItemsNum|fallDItemsRate|buffs|buffsLV)":\s\[(\s*\d*,?)*)\n\s*(\d*,?|\])/g, ' $3');
            break

        case 'CM':
            CM_Output.value = JSON.stringify(CM_Parameter, (k, v) => {
                if (v === "" || v === 0) {
                    if (k === 'mat2num' && CM_Parameter.mat2 != '') return 1;
                    if (k === 'mat3num' && CM_Parameter.mat3 != '') return 1;
                    if (k === 'mat4num' && CM_Parameter.mat4 != '') return 1;
                }
                if (v === "") {
                    if (k === 'mat1' || k === 'result') return '必填';
                    if (k === 'mat1num' || k === 'resultnum') return 1;
                    return;
                }
                if (typeof v === 'string') {
                    if (/^\d+$/.test(v)) {
                        return parseInt(v);
                    } else {
                        return '只能是正整数';
                    }
                }
                if (typeof v === 'number') {
                    if ((k === 'mat2num' && CM_Parameter.mat2 === '') ||
                        (k === 'mat3num' && CM_Parameter.mat3 === '') ||
                        (k === 'mat4num' && CM_Parameter.mat4 === '')) return;
                    if (v > 2147483647) return '值不能大于 2147483647';
                }
                return v;
            }, 4)
            break

        case 'WSAMMO':
            WSAMMO_Output.value = JSON.stringify(WSAMMO_Parameter, (k, v) => {
                if (v === "") {
                    return;
                }
                if (WSAMMO_Parameter.haveAnime === false &&
                    (k === 'AnimeSpeed' || k === 'anime')) {
                    return;
                }
                if (typeof v === 'string') {
                    return toUnicode(v);
                }
                if (k === 'anime') {
                    return v.filter((x) => { return x !== '' && x !== null });
                }
                return v;
            }, 4).replaceAll('\\\\u', '\\u')
            break
    }

}
//复制文本到剪切板
const copyToClipboard = async () => {
    var r = ''
    switch (activeName.value) {
        case 'WSITEM':
            r = WSITEM_Output.value
            break
        case 'CM':
            r = CM_Output.value
            break
        case 'WSAMMO':
            r = WSAMMO_Output.value
            break
    }
    try {
        await navigator.clipboard.writeText(r)
        ElMessage({
            message: '复制成功',
            type: 'success',
        })
    } catch (err) {
        ElMessage({
            message: '复制失败',
            type: 'error',
        })
    }
}
const download = () => {
  var r = '', name = '';
  switch (activeName.value) {
    case 'WSITEM':
      r = WSITEM_Output.value
      name = 'WSITEM_' + WSITEM_Parameter['ID']
      break
    case 'CM':
      r = CM_Output.value
      name = 'CM_' + CM_Parameter['ID']
      break
    case 'WSAMMO':
      r = WSAMMO_Output.value
      name = 'WSAMMO_' + WSAMMO_Parameter['AID']
      break
  }
  const blob = new Blob([r], {type: "application/json;charset=utf-8"});
  FileSaver.saveAs(blob, name + ".json");
  ElMessage({
    message: '下载成功',
    type: 'success',
  })
}

onMounted(() => {
    generateOutput()
})
</script>

<style>
.main {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.labeldiv {
    margin: 5px 0;
    flex-basis: calc(50% - 10px);
}

.labelbox {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
}

.btn-1 {
    margin-top: 20px;
    width: 160px;
    height: 50px;
    border-radius: 10px;
}

.workspace {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.workspace .el-select__input {
    width: 100% !important;
}

@media screen and (width <=768px) {
    .el-place {
        width: 300px;
    }
}

@media screen and (width > 768px) {
    .el-place {
        width: 500px;
    }
}

.table {
    background-color: transparent;
    border: 1px solid var(--el-border-color);

    tr,
    th,
    td {
        background-color: transparent;
        border: none;
    }

    th,
    td {
        border-bottom: 1px solid var(--el-border-color);
    }
}

.el-input-number {
    width: 100%;
}

.el-form-item__content {
    flex-direction: column !important;
    align-items: flex-start !important;
    width: 100%;
}
</style>